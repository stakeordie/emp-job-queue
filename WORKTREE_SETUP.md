# Worktree Setup - Quick Start for Agents

**Critical:** Agents must be able to create worktrees and test rapidly. Follow this exact sequence.

## 1. Create Worktree (30 seconds)

```bash
# From main repo
git worktree add -b your-branch-name ../your-worktree-name

# Navigate to worktree
cd ../your-worktree-name
```

## 2. Environment Setup (60 seconds)

```bash
# Copy secrets from master (CRITICAL STEP)
cp /Users/the_dusky/code/emprops/ai_infra/emp-job-queue/config/environments/secrets/.env.secrets.local config/environments/secrets/.env.secrets.local

# Build env-management package first (REQUIRED)
pnpm build --filter=@emp/env-management

# Build all environments
pnpm env:build local-dev && pnpm env:build remote-dev && pnpm env:build production
```

## 3. Install Dependencies (2 minutes)

```bash
# Install all dependencies
pnpm install

# Generate Prisma client (REQUIRED)
pnpm --filter=@emp/database prisma generate

# Build core packages
pnpm build --filter=@emp/core
```

## 4. Test Readiness Check (30 seconds)

```bash
# Verify Redis connection
redis-cli -u "$(grep REDIS_URL .env.local-dev | cut -d= -f2)" ping

# Should return: PONG
```

## 5. Quick Test Commands

### Test Telemetry Client
```bash
REDIS_URL="$(grep REDIS_URL .env.local-dev | cut -d= -f2)" node -e "
const { createEventClient, EventTypes } = require('./packages/core/dist/telemetry/index.js');
(async () => {
  const client = createEventClient('test');
  await client.event(EventTypes.SERVICE_STARTED, {test: true});
  console.log('✅ Telemetry works');
  await client.close();
})();
"
```

### Start Services
```bash
# Terminal 1: Start collector
cd apps/telemetry-collector && pnpm dev

# Terminal 2: Start API
pnpm dev:api

# Terminal 3: Start worker
pnpm dev:worker
```

## 6. Verification

After setup, you should be able to:
- ✅ Connect to Redis
- ✅ Build all packages
- ✅ Send telemetry events
- ✅ Start all services

## Common Issues

**Missing .env.secret.local-dev**: Copy from master worktree
**Redis connection failed**: Check REDIS_URL in .env.local-dev
**Build errors**: Run `pnpm install` first
**Package not found**: Run `pnpm build --filter=@emp/core`

## Files You Need

```
.env.secret.local-dev   # Copied from master
.env.local-dev          # Generated by pnpm env:build
.env.remote-dev         # Generated by pnpm env:build
node_modules/           # Generated by pnpm install
packages/*/dist/        # Generated by pnpm build
```

**Total Setup Time: ~4 minutes**