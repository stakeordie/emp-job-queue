{
  "name": "Full Local Development",
  "description": "All components running locally for offline development",
  "components": {
    "redis": [
      "default",
      "local"
    ],
    "api": [
      "default",
      "local"
    ],
    "machine": [
      "default",
      "local"
    ],
    "worker": [
      "default",
      "local"
    ],
    "monitor": [
      "default",
      "local"
    ],
    "comfyui": [
      "default",
      "local"
    ],
    "simulation": [
      "local",
      "big"
    ]
  },
  "services": {
    "setup": {
      "command": "echo 'Cleaning up port conflicts...' && pkill -f 'port.*3331' || pkill -f 'port.*3333' || true",
      "background": false,
      "delay": 1000
    },
    "redis": {
      "command": "dev:local-redis",
      "depends_on": [
        "setup"
      ],
      "delay": 3000,
      "background": true
    },
    "api": {
      "command": "dev",
      "filter": "api",
      "depends_on": [
        "redis"
      ],
      "delay": 2000,
      "background": true
    },
    "monitor": {
      "command": "dev",
      "filter": "monitor",
      "depends_on": [
        "redis",
        "api"
      ],
      "delay": 2000,
      "background": true
    },
    "machine": {
      "command": "machine:local:up:build",
      "depends_on": [
        "redis",
        "api"
      ],
      "delay": 5000,
      "background": true
    }
  },
  "secrets": [
    "AWS_ACCESS_KEY_ID",
    "AWS_SECRET_ACCESS_KEY_ENCODED"
  ],
  "validation": {
    "required_services": [
      "redis"
    ],
    "port_conflicts": [
      6379,
      3331,
      3333,
      8188,
      9090
    ]
  },
  "docker": {
    "services": {
      "redis": {
        "image": "redis:7-alpine",
        "ports": ["6379:6379"],
        "volumes": ["redis_data:/data"],
        "condition": "components.redis includes 'local'"
      },
      "machine": {
        "build": "./apps/machine",
        "environment": [".env"],
        "volumes": [
          "./apps/worker/bundled:/workspace/worker-bundled",
          "machine_workspace:/workspace"
        ],
        "deploy": {
          "resources": {
            "reservations": {
              "devices": [{"driver": "nvidia", "capabilities": ["gpu"]}]
            }
          }
        },
        "ports": ["8188:8188", "8189:8189"],
        "depends_on": ["redis"],
        "condition": "components.machine includes 'local'"
      }
    },
    "volumes": {
      "redis_data": {},
      "machine_workspace": {}
    }
  }
}