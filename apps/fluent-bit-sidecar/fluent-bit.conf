# Fluent Bit Configuration for Worker Log Collection
[SERVICE]
    Flush 5
    Log_Level info
    Daemon off

# Accept logs from worker processes via HTTP
[INPUT]
    Name http
    Tag worker.logs
    Host 0.0.0.0
    Port 9880

# Add worker metadata to all logs
[FILTER]
    Name record_modifier
    Match worker.*
    Record machine_id ${MACHINE_ID}
    Record worker_id ${WORKER_ID}
    Record service_type ${SERVICE_TYPE}
    Record level info
    Record source fluent-bit

# Debug: Print to stdout first to see the data
[OUTPUT]
    Name stdout
    Match worker.*
    Format json_lines

# Send to Fluentd service - simpler HTTP approach
[OUTPUT]
    Name http
    Match worker.*
    Host ${FLUENTD_HOST}
    Port 8888
    URI /test
    Format json
    json_date_key date
    json_date_format epoch