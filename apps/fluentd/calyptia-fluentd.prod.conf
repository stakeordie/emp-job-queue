# Calyptia Fluentd Configuration - PRODUCTION
# Simple HTTP input -> Dash0 output

# HTTP Input - receives logs on port 8888
<source>
  @type http
  port 8888
  bind 0.0.0.0
</source>

# Monitoring endpoint
<source>
  @type monitor_agent
  port 24220
  bind 0.0.0.0
</source>

# Handle Fluentd's own logs (removes the warning)
<label @FLUENT_LOG>
  <match fluent.**>
    @type null
  </match>
</label>

# Send all logs to Dash0
<match **>
  @type http
  endpoint https://ingress.us-west-2.aws.dash0.com/logs/json
  http_method post

  # Production environment headers (UPDATE THESE VALUES)
  headers {"Authorization":"Bearer PROD_API_KEY_HERE","Content-Type":"application/json","Dash0-Dataset":"production"}

  <format>
    @type json
  </format>

  <buffer>
    @type memory
    flush_interval 10s
    flush_thread_count 2
  </buffer>
</match>