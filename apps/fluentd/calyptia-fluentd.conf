# Calyptia Fluentd Configuration
# Simple HTTP input -> Dash0 output

# HTTP Input - receives logs on port 8888
<source>
  @type http
  port 8888
  bind 0.0.0.0
</source>

# Monitoring endpoint
<source>
  @type monitor_agent
  port 24220
  bind 0.0.0.0
</source>

# Handle Fluentd's own logs (removes the warning)
<label @FLUENT_LOG>
  <match fluent.**>
    @type null
  </match>
</label>

# Send all logs to Dash0
<match **>
  @type http
  endpoint https://ingress.us-west-2.aws.dash0.com/logs/json
  http_method post

  # Headers with hardcoded values (env vars don't work in all contexts)
  headers {"Authorization":"Bearer auth_w8VowQspnZ8whZHWp1pe6azIIehBAAvL","Content-Type":"application/json","Dash0-Dataset":"development"}

  <format>
    @type json
  </format>

  <buffer>
    @type memory
    flush_interval 5s
  </buffer>
</match>