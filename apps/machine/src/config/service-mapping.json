{
  "workers": {
    "comfyui": {
      "services": ["comfyui"],
      "is_gpu_bound": true,
      "job_service_required_map": [
        {
          "job_service_required": "comfyui",
          "worker_service": "comfyui"
        }
      ]
    },

    "comfyui-remote": {
      "services": ["comfyui-remote"],
      "is_gpu_bound": false,
      "job_service_required_map": [
        {
          "job_service_required": "comfyui",
          "worker_service": "comfyui-remote"
        }
      ]
    },
    
    "simulation-websocket": {
      "services": ["simulation-websocket"],
      "is_gpu_bound": true,
      "job_service_required_map": [
        {
          "job_service_required": "simulation",
          "worker_service": "simulation-websocket" 
        }
      ]
    },

    "simulation-http": {
      "services": ["simulation-http"],
      "is_gpu_bound": true,
      "job_service_required_map": [
        {
          "job_service_required": "simulation",
          "worker_service": "simulation-http" 
        }
      ]
    },
    
    "openai": {
      "services": ["openai-text", "openai-image", "openai-img2img"],
      "is_gpu_bound": false,
      "required_env": ["OPENAI_API_KEY", "OPENAI_IMAGE_MODEL", "CLOUD_STORAGE_PROVIDER"],
      "job_service_required_map": [
        {
          "job_service_required": "openai_text",
          "worker_service": "openai-text"
        },
        {
          "job_service_required": "openai_image",
          "worker_service": "openai-image"
        },
        {
          "job_service_required": "openai_img2img",
          "worker_service": "openai-img2img"
        }
      ]
    }
  },

  "machine_capabilities": {
    "auto_detect": {
      "gpu": {
        "detection_method": "nvidia-smi",
        "fallback": "environment_variable",
        "env_var": "NUM_GPUS"
      },
      "cpu_cores": {
        "detection_method": "os.cpus().length"
      },
      "memory": {
        "detection_method": "os.totalmem()"
      },
      "storage": {
        "detection_method": "fs.statSync"
      },
      "network_access": {
        "detection_method": "ping_test",
        "test_urls": ["api.openai.com", "github.com"]
      },
      "cloud_storage": {
        "detection_method": "environment_variable",
        "required_env": ["CLOUD_STORAGE_PROVIDER"]
      }
    },
    "static": {
      "docker": true,
      "node_js": true,
      "local_storage": true
    }
  },

  "connectors": {
    "ComfyUIWebSocketConnector": {
      "path": "./redis-direct-worker.js",
      "description": "Local ComfyUI WebSocket connector - uses internal ComfyUI installation"
    },
    "ComfyUIRemoteConnector": {
      "path": "./redis-direct-worker.js", 
      "description": "Remote ComfyUI WebSocket connector - connects to external ComfyUI instance"
    },
    "SimulationHttpConnector": {
      "path": "./redis-direct-worker.js",
      "description": "Simulation processing connector for testing and development"
    },
    "SimulationWebsocketConnector": {
      "path": "./redis-direct-worker.js",
      "description": "Simulation processing connector for testing and development with Websocket"
    },
    "OpenAITextConnector": {
      "path": "./redis-direct-worker.js",
      "description": "OpenAI text generation API connector"
    },
    "OpenAIImageConnector": {
      "path": "./redis-direct-worker.js",
      "description": "OpenAI image generation API connector"
    },
    "OpenAIImg2ImgConnector": {
      "path": "./redis-direct-worker.js",
      "description": "OpenAI image-to-image generation API connector"
    }
  },

  "services": {
    "comfyui": {
      "connector": "ComfyUIWebSocketConnector",
      "type": "internal",
      "installer": "ComfyUIManagementClient",
      "installer_filename": "./services/comfyui-management-client.js",
      "is_gpu_bound": true,
      "build_stage": "comfyui",
      "service_instances_per_gpu": "${COMFYUI_INSTANCES_PER_GPU:-1}",
      "ports": ["${COMFYUI_BASE_PORT:-8188}"],
      "port_increment": "${COMFYUI_PORT_INCREMENT:-1}",
      "description": "ComfyUI image generation service with local installation",
      "installer_config": {
        "branch": "${COMFYUI_BRANCH:-main}",
        "repo_url": "${COMFYUI_REPO_URL:-https://github.com/stakeordie/ComfyUI.git}",
        "custom_nodes_enabled": "${COMFYUI_ENABLE_CUSTOM_NODES:-true}",
        "models_path": "${COMFYUI_MODELS_PATH:-/workspace/ComfyUI/models}",
        "install_timeout": "${COMFYUI_INSTALL_TIMEOUT:-300}"
      }
    },
    
    "comfyui-remote": {
      "connector": "ComfyUIRemoteConnector",
      "type": "external",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": false,
      "build_stage": "base",
      "description": "Remote ComfyUI WebSocket connector - connects to external ComfyUI instance"
    },
    
    "simulation-http": {
      "connector": "SimulationHttpConnector",
      "type": "internal",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": true,
      "build_stage": "simulation",
      "service_instances_per_machine": "${SIMULATION_INSTANCES_PER_MACHINE:-10}",
      "ports": ["${SIMULATION_BASE_PORT:-8299}"],
      "port_increment": "${SIMULATION_PORT_INCREMENT:-0}",
      "description": "Simulation service for testing and development",
      "installer_config": {
        "test_mode": "${SIMULATION_TEST_MODE:-true}",
        "data_path": "${SIMULATION_DATA_PATH:-/workspace/simulation/data}",
        "capabilities": "${SIMULATION_CAPABILITIES:-image_generation,text_processing}"
      }
    },

    "simulation-websocket": {
      "connector": "SimulationWebsocketConnector",
      "type": "internal",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": true,
      "build_stage": "simulation",
      "service_instances_per_machine": "${SIMULATION_WS_INSTANCES_PER_MACHINE:-10}",
      "ports": ["${SIMULATION_WS_BASE_PORT:-8399}"],
      "port_increment": "${SIMULATION_WS_PORT_INCREMENT:-0}",
      "description": "WebSocket simulation service for testing and development",
      "installer_config": {
        "test_mode": "${SIMULATION_WS_TEST_MODE:-true}",
        "data_path": "${SIMULATION_WS_DATA_PATH:-/workspace/simulation-ws/data}",
        "capabilities": "${SIMULATION_WS_CAPABILITIES:-websocket,realtime,streaming}"
      }
    },
    
    "openai-text": {
      "connector": "OpenAITextConnector",
      "type": "external",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": false,
      "build_stage": "base",
      "required_env": ["OPENAI_API_KEY"],
      "description": "OpenAI text generation API connector",
      "api_config": {
        "base_url": "${OPENAI_BASE_URL:-https://api.openai.com/v1}",
        "timeout": "${OPENAI_TIMEOUT:-60}",
        "max_retries": "${OPENAI_MAX_RETRIES:-3}",
        "text_models": "${OPENAI_TEXT_MODELS:-gpt-4,gpt-3.5-turbo}"
      }
    },
    
    "openai-image": {
      "connector": "OpenAIImageConnector", 
      "type": "external",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": false,
      "build_stage": "base",
      "required_env": ["OPENAI_API_KEY", "OPENAI_IMAGE_MODEL", "CLOUD_STORAGE_PROVIDER"],
      "description": "OpenAI image generation API connector",
      "api_config": {
        "base_url": "${OPENAI_BASE_URL:-https://api.openai.com/v1}",
        "timeout": "${OPENAI_TIMEOUT:-60}",
        "max_retries": "${OPENAI_MAX_RETRIES:-3}",
        "image_models": "${OPENAI_IMAGE_MODELS:-dall-e-3,dall-e-2}"
      }
    },
    
    "openai-img2img": {
      "connector": "OpenAIImg2ImgConnector",
      "type": "external",
      "installer": null,
      "installer_filename": null,
      "is_gpu_bound": false, 
      "build_stage": "base",
      "required_env": ["OPENAI_API_KEY", "OPENAI_IMAGE_MODEL", "CLOUD_STORAGE_PROVIDER"],
      "description": "OpenAI image-to-image generation API connector",
      "api_config": {
        "base_url": "${OPENAI_BASE_URL:-https://api.openai.com/v1}",
        "timeout": "${OPENAI_TIMEOUT:-60}",
        "max_retries": "${OPENAI_MAX_RETRIES:-3}",
        "image_models": "${OPENAI_IMAGE_MODELS:-dall-e-3,dall-e-2}"
      }
    }
  },
  
  "service_types": {
    "internal": {
      "description": "Services that require installation and setup",
      "requires_installer": true,
      "has_ports": true,
      "has_pm2_process": true
    },
    "external": {
      "description": "External API services (no installation)",
      "requires_installer": false,
      "has_ports": false,
      "has_pm2_process": false
    }
  }
}