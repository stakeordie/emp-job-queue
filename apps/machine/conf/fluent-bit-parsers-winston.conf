# Fluent Bit Parser Configuration for Winston Logs

# JSON parser for Winston structured logs
[PARSER]
    Name json
    Format json
    Time_Key timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep On
    Decode_Field_As json message

# JSON parser for nested Winston logs
[PARSER]
    Name winston_json
    Format json
    Time_Key timestamp
    Time_Format %Y-%m-%d %H:%M:%S.%L
    Time_Keep On
    Decode_Field_As escaped message

# Parser for OpenAI API responses
[PARSER]
    Name openai_response
    Format json
    Time_Key created
    Time_Format %s
    Time_Keep On

# Parser for OpenAI usage data
[PARSER]
    Name openai_usage
    Format json
    Decode_Field_As json usage

# Multiline parser for stack traces
[MULTILINE_PARSER]
    Name error_stack
    Type regex
    Rule "start_state" "/^{\"timestamp\":/" "json_line"
    Rule "json_line" "/^(?!{\"timestamp\":)/" "json_line"