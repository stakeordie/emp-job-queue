# Streamlined Docker Compose for base_machine development
# Using only emprops-27128-devel service for active development
# Full service archive available in docker-compose.archive.yml

x-base-service: &base-service
  env_file:
    - .env.local
  build:
    context: .
    dockerfile: Dockerfile
    platforms:
      - linux/amd64
    args:
      # Updated: 2025-05-14T18:42:32-04:00 - Added CUDA version selection
      CUDA_VERSION: 0
      START_BUST: 0
      MIDDLE_BUST: 0
      SHARED_BUST: 0
      LANGFLOW_BUST: 0
      A1111_A_BUST: 0
      A1111_B_BUST: 0
      A1111_C_BUST: 0
      END_BUST: 0
  ports:
    - "${BASE_PORT_START:-2001}:2001"
    - "${BASE_PORT_2:-2002}:2002"
    - "${BASE_PORT_3:-2003}:2003"
    - "${BASE_PORT_4:-2004}:2004"
    - "${BASE_PORT_5:-2005}:2005"
    - "${BASE_PORT_6:-2006}:2006"
    - "${BASE_PORT_7:-2007}:2007"
    - "${BASE_PORT_8:-2008}:2008"
    - "${BASE_JUPYTER_PORT:-2860}:2860"
    - "${BASE_COMFYUI_1:-3188}:3188"
    - "${BASE_COMFYUI_2:-3189}:3189"
    - "${BASE_COMFYUI_3:-3190}:3190"
    - "${BASE_COMFYUI_4:-3191}:3191"
    - "${BASE_COMFYUI_5:-3192}:3192"
    - "${BASE_COMFYUI_6:-3193}:3193"
    - "${BASE_COMFYUI_7:-3194}:3194"
    - "${BASE_COMFYUI_8:-3195}:3195"
  restart: unless-stopped
  platform: linux/amd64

services:
  # Primary development service - PyTorch 2.7.0 with CUDA 12.8 development tools
  base_machine:
    <<: *base-service
    container_name: base-machine
    image: emprops/base-machine:latest
    build:
      args:
        # Updated: 2025-05-14T18:42:32-04:00 - Using CUDA 12.8 for this service
        BASE_IMAGE: pytorch/pytorch:2.7.0-cuda12.8-cudnn9-devel
        COMFY_REPO_URL: https://github.com/stakeordie/ComfyUI.git